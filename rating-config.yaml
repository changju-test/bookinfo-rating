apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: rating-pvc
spec:
  resources:
    requests:
      storage: 1Gi
  volumeMode: Filesystem
  accessModes:
    - ReadWriteOnce
---
apiVersion: cicd.tmax.io/v1
kind: IntegrationConfig
metadata:
  name: bookinfo-rating-config-test
spec:
  git:
    type: github
    apiUrl: ""
    repository: changju-test/bookinfo-rating
    token:
      valueFrom:
        secretKeyRef:
          name: git-token
          key: token
  workspaces:
    - name : rating-workspace
      persistentVolumeClaim:
        claimName: rating-pvc
  secrets:
    - name : tmaxcloudck-docker-hub-secret
  jobs:
    postSubmit:
      - name: s2i-gradle-generate
        image: docker.io/tmaxcloudck/cicd-util:5.0.5
        env: 
          - name: JAR_NAME
            value : rating.jar
        script: |
          /usr/local/bin/s2i \
          build . docker.io/changjjjjjjjj/s2i-gradle-java:dev \
          --env JAR_NAME=$JAR_NAME \
          --tlsverify=false \
          --as-dockerfile $(workspaces.rating-workspace.path)/Dockerfile.gen